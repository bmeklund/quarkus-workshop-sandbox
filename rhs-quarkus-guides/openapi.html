<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Documenting APIs in Quarkus :: Quarkus Workshop Guides</title>
    <link rel="canonical" href="https://github.com/bmeklund/quarkus-workshop-sandbox/rhs-quarkus-guides/openapi.html">
    <link rel="prev" href="panache.html">
    <link rel="next" href="messaging.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../_/img/RHDLogo.svg" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="https://github.com/bmeklund/quarkus-workshop-sandbox">Quarkus Workshop Guides</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhs-quarkus-guides" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">Quarkus Workshop Guides</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="intro.html">Lab Instructions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Module One</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="basics.html">Getting Started with Quarkus</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cdi.html">Dependency Injection</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="testing.html">Testing Quarkus Apps</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="debugging.html">Debugging Quarkus Apps</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="native.html">Building Native Quarkus Apps</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cloudnative.html">Developing Cloud Native with Quarkus</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="deploy.html">Deploying to the cloud</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Module Two</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="extensions.html">Using Quarkus extensions</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="panache.html">Hibernate ORM with Panache</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="openapi.html">Documenting and Testing APIs</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="messaging.html">Event-driven Messaging</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="kafka.html">Streaming Data with Quarkus and Kafka</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="monitoring.html">Monitoring with Prometheus and Grafana</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="tracing.html">Tracing Quarkus Apps with Jaeger and MicroProfile Tracing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="security.html">Securing Quarkus APIs</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Quarkus Workshop Guides</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Quarkus Workshop Guides</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Quarkus Workshop Guides</a></li>
    <li>Module Two</li>
    <li><a href="openapi.html">Documenting and Testing APIs</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/bmeklund/quarkus-workshop-sandbox/edit/master/documentation/modules/ROOT/pages/openapi.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Documenting APIs in Quarkus</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Exposing APIs has become an essential part of all modern applications. At the center of this revolution known as the <em>API Economy</em> we find <em>RESTful</em> APIs, which can transform any application into language agnostic services that can be called from anywhere: on-premises, private cloud, public cloud, etc.</p>
</div>
<div class="paragraph">
<p>This guide explains how your Quarkus application can expose its API description through an OpenAPI specification and how you can test it via a user-friendly UI named <em>Swagger UI</em>.</p>
</div>
<div class="paragraph">
<p>An OpenAPI definition can then be used by documentation generation tools to display the API, code generation tools to generate servers and clients in various programming languages, testing tools, and many other use cases.</p>
</div>
<div class="paragraph">
<p>Quarkus implements the <a href="https://github.com/eclipse/microprofile-open-api/" target="_blank" rel="noopener">MicroProfile Open API Specification</a> and as such exposes several developer APIs for documenting your application&#8217;s APIs.</p>
</div>
<div class="paragraph">
<p>The MicroProfile OpenAPI specification requires vendors to produce a valid OpenAPI document from pure JAX-RS 2.0 applications, without the developer adding any special annotations for OpenAPI. This means that vendors must process all the relevant JAX-RS annotations (such as <code>@Path</code> and <code>@Consumes</code>) as well as Java objects (POJOs) used as input or output to JAX-RS operations.</p>
</div>
<div class="paragraph">
<p>Therefore you as a developer get a <em>lot</em> of functionality out of the box without doing anything. Let&#8217;s test this out.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_add_extension"><a class="anchor" href="#_add_extension"></a>Add Extension</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We need to add another extension for OpenAPI. Run the following command:</p>
</div>
<div class="listingblock copypaste">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">mvn quarkus:add-extension -Dextensions="smallrye-openapi"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">[INFO] [SUCCESS] ✅  Extension io.quarkus:quarkus-smallrye-openapi has been installed</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will add the necessary extension for using OpenAPI, and a graphical frontend extension called <strong>Swagger</strong> which we&#8217;ll discuss later. It also enables a new RESTful endpoint in the app accessible at <code>/q/openapi</code>.</p>
</div>
<div class="paragraph">
<p>Access the new endpoint using the following command in a Terminal:</p>
</div>
<div class="listingblock copypaste">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">curl http://localhost:8080/q/openapi</code></pre>
</div>
</div>
<div class="paragraph">
<p>This endpoint was created as part of the Quarkus OpenAPI Extension, and emits a programmatic description of your current endpoints as yaml (or json):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">openapi: 3.0.3
info:
  title: people API
  version: 1.0-SNAPSHOT
paths:
  /hello:
    get:
      responses:
        "200":
          description: OK
          content:
            text/plain:
              schema:
                type: string
  /person:
    get:
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Person'
# ... and the rest of your endpoints</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you want JSON instead of YAML, use</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">curl -H "Accept: application/json" http://localhost:8080/q/openapi</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So out of the box all your endpoints are fully documented and will be emitted in a programmatic format from the <code>/openapi</code> endpoint. CLIs are great, but for quick testing of APIs, wouldn&#8217;t it be great if that programmatic API was turned into an interactive, forms-based web page for quickly trying out endpoints? That&#8217;s what <em>Swagger UI</em> does.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_access_swagger_ui"><a class="anchor" href="#_access_swagger_ui"></a>Access Swagger UI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When building APIs, developers want to test them quickly. Swagger UI is a great tool for visualizing and interacting with your APIs. The UI is automatically generated from your OpenAPI specification.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, Swagger UI is only available when Quarkus is started in <em>dev</em> or <em>test</em> mode.</p>
</div>
<div class="paragraph">
<p>If you want to make it available in production too, you can include the following configuration in your application.properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">quarkus.swagger-ui.always-include=true</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since our app is still running, when you open the <code>index-webpage</code> in the <strong>ENDPOINTS</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/weblink.png" alt="swagger" width="700">
</div>
</div>
<div class="paragraph">
<p>Then, click on <code>Open</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/weblink-open.png" alt="swagger" width="700">
</div>
</div>
<div class="paragraph">
<p>Then, add <code>/q/swagger-ui</code> to the end of the URL to access the Swagger UI and play with your API. Be sure to use <strong>http</strong> protocal to access the Swagger UI page.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/swagger.png" alt="swagger" width="700">
</div>
</div>
<div class="paragraph">
<p>Using the UI, expand the <code>/person/birth/before/{year}</code> endpoint. Here you can basic detail about the endpoint: the name of the endpoint, parameters and their type, and the response type one can expect.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/swaggeryear.png" alt="swaggeryear" width="900">
</div>
</div>
<div class="paragraph">
<p>Select the <strong>Try it out</strong> button to expand the box allowing you to try it. Enter the year <code>1990</code> in the box and select <strong>Execute</strong>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/swaggeryeartest.png" alt="swaggeryeartest" width="900">
</div>
</div>
<div class="paragraph">
<p>This accesses the endpoint in the same way that <code>curl</code> does, and shows you the result (along with corresponding metadata in the HTTP response):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/swaggeryeartestresult.png" alt="swaggeryeartestresult" width="900">
</div>
</div>
<div class="paragraph">
<p>Pretty handy way to test out your APIs!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_documenting_your_apis"><a class="anchor" href="#_documenting_your_apis"></a>Documenting your APIs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenAPI and Swagger are useful tools but they become even more useful to 3rd party consumers of your API if you properly document them. With OpenAPI, you as a developer can add additional annotations right into the code to document them (which is a good practice anyway - when the code changes, the docs can too).</p>
</div>
<div class="paragraph">
<p>You as an application developer have a few choices in documenting your APIs:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Augment your JAX-RS annotations with the OpenAPI <a href="https://github.com/eclipse/microprofile-open-api/blob/master/spec/src/main/asciidoc/microprofile-openapi-spec.adoc#annotations" target="_blank" rel="noopener">Annotations</a>. Using annotations means you don’t have to re-write the portions of the OpenAPI document that are already covered by the JAX-RS framework (e.g. the HTTP method of an operation).</p>
</li>
<li>
<p>Take the initial output from <code>/openapi</code> as a starting point to document your APIs via <a href="https://github.com/eclipse/microprofile-open-api/blob/master/spec/src/main/asciidoc/microprofile-openapi-spec.adoc#static-openapi-files" target="_blank" rel="noopener">Static OpenAPI files</a> (and then check those into source code repositories and update when APIs change). It’s worth mentioning that these static files can also be written before any code, which is an approach often adopted by enterprises that want to lock-in the contract of the API. In this case, we refer to the OpenAPI document as the "source of truth", by which the client and provider must abide.</p>
</li>
<li>
<p>Use the <a href="https://github.com/eclipse/microprofile-open-api/blob/master/spec/src/main/asciidoc/microprofile-openapi-spec.adoc#programming-model" target="_blank" rel="noopener">Programming model</a> to provide a bootstrap (or complete) OpenAPI model tree.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Additionally, a <a href="https://github.com/eclipse/microprofile-open-api/blob/master/spec/src/main/asciidoc/microprofile-openapi-spec.adoc#filter" target="_blank" rel="noopener">Filter</a> is described which can update the OpenAPI model after it has been built from the previously described documentation mechanisms.</p>
</div>
<div class="paragraph">
<p>So let&#8217;s add a bit more documentation to our <code>/person/birth/before/{year}</code> endpoint using the first option (annotations). Open the <code>PersonResource</code> class, and find the <code>getBeforeYear</code> method&#8201;&#8212;&#8201;this method implements our endpoint.</p>
</div>
<div class="sect2">
<h3 id="_add_openapi_annotations"><a class="anchor" href="#_add_openapi_annotations"></a>Add OpenAPI annotations</h3>
<div class="paragraph">
<p>Add a few annotations:</p>
</div>
<div class="paragraph">
<p><strong>1. Add an <code>@Operation</code> annotation on the <code>getBeforeYear</code> method to provide a brief summary and description:</strong></p>
</div>
<div class="listingblock copypaste">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @Operation(summary = "Finds people born before a specific year",
           description = "Search the people database and return a list of people born before the specified year")</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>2. Add an <code>@ApiResponses</code> annotation below the <code>@Operation</code> that documents two of the possible HTTP return values ("200" and "500") to the method signature:</strong></p>
</div>
<div class="listingblock copypaste">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @APIResponses(value = {
        @APIResponse(responseCode = "200", description = "The list of people born before the specified year",
            content = @Content(
                schema = @Schema(implementation = Person.class)
            )),
        @APIResponse(responseCode = "500", description = "Something bad happened")
    })</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>3. Add an additional bit of documentation before the existing <code>@PathParam</code> method parameter:</strong></p>
</div>
<div class="listingblock copypaste">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Parameter(description = "Cutoff year for searching for people", required = true, name="year")</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can individually import the correct classes, but here are the imports you can add to the top of your class to fix the errors in the IDE:</p>
</div>
<div class="listingblock copypaste">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.eclipse.microprofile.openapi.annotations.Operation;
import org.eclipse.microprofile.openapi.annotations.parameters.Parameter;
import org.eclipse.microprofile.openapi.annotations.responses.APIResponses;
import org.eclipse.microprofile.openapi.annotations.responses.APIResponse;
import org.eclipse.microprofile.openapi.annotations.media.Content;
import org.eclipse.microprofile.openapi.annotations.media.Schema;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The final method should look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @Operation(summary = "Finds people born before a specific year",
        description = "Search the people database and return a list of people born before the specified year")
    @APIResponses(value = {
        @APIResponse(responseCode = "200", description = "The list of people born before the specified year",
        content = @Content(
            schema = @Schema(implementation = Person.class)
        )),
        @APIResponse(responseCode = "500", description = "Something bad happened")
    })
    @GET
    @Path("/birth/before/{year}")
    @Produces(MediaType.APPLICATION_JSON)
    public List&lt;Person&gt; getBeforeYear(
        @Parameter(description = "Cutoff year for searching for people", required = true, name="year")
        @PathParam(value = "year") int year) {

        return Person.getBeforeYear(year);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now reload the same Swagger UI webpage (and expand the <code>/person/birth/before/{year}</code> section). Notice the Swagger documention is more filled out for the endpoint to which we added extra OpenAPI documentation:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/swaggerparams.png" alt="swaggerparams" width="900">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_congratulations"><a class="anchor" href="#_congratulations"></a>Congratulations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this exercise you learned more about the MicroProfile OpenAPI specification and how to use it to do in-place documentation of your RESTful microservice APIs.</p>
</div>
<div class="paragraph">
<p>There are additional types of documentation you can add, for example you can declare the security features and requirements of your API and then use these where appropriate in your paths and operations.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="panache.html" class="query-params-link">Hibernate ORM with Panache</a></span>
  <span class="next"><a href="messaging.html" class="query-params-link">Event-driven Messaging</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
